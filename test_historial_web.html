<!DOCTYPE html>
<html>
<head>
    <title>Prueba de Historial con Fecha del Cliente - API Biblioteca</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .result { margin: 10px 0; padding: 10px; background: #f0f0f0; }
        .info { background: #e3f2fd; padding: 10px; margin: 10px 0; border-left: 4px solid #2196f3; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
    </style>
    <script src="js/fechaCliente.js"></script>
</head>
<body>
    <h1>Prueba de Historial con Fecha del Cliente</h1>
    
    <div class="info">
        <strong>üìÖ Fecha/Hora actual del cliente:</strong> <span id="fecha-actual"></span><br>
        <strong>üåç Zona horaria:</strong> <span id="zona-horaria"></span>
    </div>
    
    <div class="test-section">
        <h3>Crear Registro de Historial (con fecha del cliente)</h3>
        <button onclick="crearHistorialManual()">Crear Registro Manual</button>
        <div id="result-manual" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>Crear Autor (historial autom√°tico)</h3>
        <button onclick="crearAutor()">Crear Autor de Prueba</button>
        <div id="result-autor" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>Ver Historial</h3>
        <button onclick="verHistorial()">Ver √öltimos Registros de Historial</button>
        <div id="result-historial" class="result"></div>
    </div>

    <script>
        // Mostrar fecha actual del cliente
        function actualizarFechaActual() {
            document.getElementById('fecha-actual').textContent = obtenerFechaCliente();
            document.getElementById('zona-horaria').textContent = Intl.DateTimeFormat().resolvedOptions().timeZone;
        }
        
        // Actualizar cada segundo
        actualizarFechaActual();
        setInterval(actualizarFechaActual, 1000);

        async function crearHistorialManual() {
            try {
                const response = await fetch('/ProyectoApi/ProyectoAPIs/view/API/historial.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        id_lector: null,
                        accion: 'Registro manual creado desde el navegador - ' + new Date().toLocaleString(),
                        fecha_cliente: obtenerFechaCliente() // Fecha del cliente
                    })
                });
                const result = await response.json();
                document.getElementById('result-manual').innerHTML = '<pre>' + JSON.stringify(result, null, 2) + '</pre>';
            } catch (error) {
                document.getElementById('result-manual').innerHTML = 'Error: ' + error;
            }
        }

        async function crearAutor() {
            try {
                const response = await fetch('/ProyectoApi/ProyectoAPIs/view/API/autores.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        nombre: 'Autor Test ' + Date.now(),
                        nacionalidad: 'Pa√≠s Test'
                    })
                });
                const result = await response.json();
                document.getElementById('result-autor').innerHTML = '<pre>' + JSON.stringify(result, null, 2) + '</pre>';
            } catch (error) {
                document.getElementById('result-autor').innerHTML = 'Error: ' + error;
            }
        }

        async function verHistorial() {
            try {
                const response = await fetch('/ProyectoApi/ProyectoAPIs/view/API/historial.php');
                const result = await response.json();
                // Mostrar solo los √∫ltimos 10 registros
                const ultimos = result.data ? result.data.slice(-10) : [];
                document.getElementById('result-historial').innerHTML = '<pre>' + JSON.stringify(ultimos, null, 2) + '</pre>';
            } catch (error) {
                document.getElementById('result-historial').innerHTML = 'Error: ' + error;
            }
        }
    </script>
</body>
</html>
